# 802.1X Port-Based Access Control ğŸ”Œ

> **IEEE 802.1X Network Access Control**

## Overview

802.1X provides port-based authentication - a port remains unauthorized until the client successfully authenticates.

## Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       802.1X Architecture                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Supplicant   â”‚     â”‚ Authenticator â”‚     â”‚   Auth Server â”‚            â”‚
â”‚  â”‚   (Client)    â”‚     â”‚ (Switch/AP)   â”‚     â”‚   (RADIUS)    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚          â”‚                     â”‚                     â”‚                     â”‚
â”‚          â”‚â—„â”€â”€â”€â”€â”€ EAPOL â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â—„â”€â”€â”€â”€â”€ RADIUS â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
â”‚          â”‚   (EAP over LAN)    â”‚                     â”‚                     â”‚
â”‚          â”‚                     â”‚                     â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ â€¢ 802.1X      â”‚     â”‚ â€¢ Controlled  â”‚     â”‚ â€¢ FreeRADIUS  â”‚            â”‚
â”‚  â”‚   client SW   â”‚     â”‚   port        â”‚     â”‚ â€¢ Cisco ISE   â”‚            â”‚
â”‚  â”‚ â€¢ OS native   â”‚     â”‚ â€¢ Pass-throughâ”‚     â”‚ â€¢ MS NPS      â”‚            â”‚
â”‚  â”‚ â€¢ wpa_suppl.  â”‚     â”‚   for EAPOL   â”‚     â”‚ â€¢ PacketFence â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## EAPOL (EAP over LAN)

```
EAPOL Frame Types:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type â”‚ Name              â”‚ Description                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0   â”‚ EAP-Packet        â”‚ Encapsulated EAP frame                      â”‚
â”‚  1   â”‚ EAPOL-Start       â”‚ Client initiates authentication             â”‚
â”‚  2   â”‚ EAPOL-Logoff      â”‚ Client logs off                             â”‚
â”‚  3   â”‚ EAPOL-Key         â”‚ Key exchange (for WPA/WPA2)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EAPOL uses Ethertype 0x888E
Destination MAC: 01:80:C2:00:00:03 (PAE group address)
```

---

## Cisco Switch Configuration

### Basic 802.1X

```cisco
! Enable AAA
aaa new-model

! Configure RADIUS server
radius server ISE
 address ipv4 192.168.1.100 auth-port 1812 acct-port 1813
 key SecretKey123

! AAA methods
aaa authentication dot1x default group radius
aaa authorization network default group radius
aaa accounting dot1x default start-stop group radius

! Enable 802.1X globally
dot1x system-auth-control

! Configure interface
interface GigabitEthernet0/1
 description User Port
 switchport mode access
 switchport access vlan 10
 authentication port-control auto
 authentication periodic
 authentication timer reauthenticate 3600
 dot1x pae authenticator
 dot1x timeout tx-period 10
 spanning-tree portfast
```

### With MAB Fallback

```cisco
interface GigabitEthernet0/1
 switchport mode access
 switchport access vlan 10
 
 ! Authentication settings
 authentication host-mode multi-auth
 authentication order dot1x mab
 authentication priority dot1x mab
 authentication port-control auto
 authentication periodic
 authentication timer reauthenticate 3600
 
 ! 802.1X
 dot1x pae authenticator
 dot1x timeout tx-period 10
 
 ! MAB (MAC Authentication Bypass)
 mab
 
 ! Guest VLAN (if auth fails)
 authentication event fail action authorize vlan 999
 
 ! Critical VLAN (if RADIUS unreachable)
 authentication event server dead action authorize vlan 999
 authentication event server alive action reinitialize
 
 spanning-tree portfast
```

### Multi-Domain (Voice + Data)

```cisco
interface GigabitEthernet0/1
 switchport mode access
 switchport access vlan 10
 switchport voice vlan 20
 
 ! Multi-domain for phone + PC
 authentication host-mode multi-domain
 authentication order dot1x mab
 authentication priority dot1x mab
 authentication port-control auto
 
 dot1x pae authenticator
 mab
 
 spanning-tree portfast
```

---

## Linux Supplicant (wpa_supplicant)

### Installation

```bash
sudo apt install wpasupplicant
```

### Wired 802.1X Configuration

```bash
# /etc/wpa_supplicant/wpa_supplicant-eth0.conf

ctrl_interface=/var/run/wpa_supplicant
ap_scan=0

network={
    key_mgmt=IEEE8021X
    eap=PEAP
    identity="username"
    password="password"
    ca_cert="/etc/ssl/certs/ca.pem"
    phase2="auth=MSCHAPV2"
    eapol_flags=0
}
```

### Start wpa_supplicant

```bash
# Manual start
sudo wpa_supplicant -i eth0 -c /etc/wpa_supplicant/wpa_supplicant-eth0.conf -D wired

# Systemd service
sudo systemctl enable wpa_supplicant@eth0
sudo systemctl start wpa_supplicant@eth0
```

---

## Troubleshooting

### Cisco Commands

```cisco
! Show authentication status
show authentication sessions
show authentication sessions interface gi0/1
show authentication sessions interface gi0/1 details

! Show 802.1X status
show dot1x all
show dot1x interface gi0/1

! Show MAB status
show mab all

! Debug (use carefully)
debug dot1x all
debug radius authentication
debug authentication all
```

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Port stays unauthorized | No supplicant | Check client 802.1X config |
| Auth timeout | RADIUS unreachable | Check RADIUS connectivity |
| Wrong VLAN | RADIUS attributes | Check RADIUS response |
| Phones not working | Voice VLAN config | Enable multi-domain |

### Packet Capture

```bash
# Capture EAPOL frames
sudo tcpdump -i eth0 ether proto 0x888e -vv

# Capture RADIUS
sudo tcpdump -i any port 1812 or port 1813 -vv
```

---

## Authorization Attributes

RADIUS can return attributes to configure the port:

```bash
# VLAN assignment
Tunnel-Type = VLAN
Tunnel-Medium-Type = IEEE-802
Tunnel-Private-Group-ID = "100"

# ACL
Filter-Id = "ACL-PERMIT-ALL"
# Or downloadable ACL (Cisco)
Cisco-AVPair = "ip:inacl#1=permit ip any any"

# Session timeout
Session-Timeout = 3600
Termination-Action = RADIUS-Request

# URL redirect (for guest)
Cisco-AVPair = "url-redirect-acl=REDIRECT-ACL"
Cisco-AVPair = "url-redirect=http://portal.example.com"
```

---

*Previous: [â† EAP](./eap.md) | Back: [Network Access README](./README.md)*

